/*
 * Copyright (C) 2012 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.android.uiautomator;

import com.android.ddmlib.CollectingOutputReceiver;
import com.android.ddmlib.IDevice;
import com.android.ddmlib.SyncService;

import io.appium.java_client.android.AndroidDriver;

import org.eclipse.core.runtime.IProgressMonitor;
import org.eclipse.core.runtime.NullProgressMonitor;
import org.eclipse.swt.graphics.Image;
import org.eclipse.swt.graphics.ImageData;
import org.eclipse.swt.graphics.PaletteData;
import org.eclipse.swt.graphics.RGB;
import org.eclipse.swt.widgets.Display;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.WebElement;

import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.awt.image.DirectColorModel;
import java.awt.image.IndexColorModel;
import java.awt.image.WritableRaster;
import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;

import javax.imageio.ImageIO;

public class UiAutomatorHelper {
	public static final int UIAUTOMATOR_MIN_API_LEVEL = 16;

	private static final String UIAUTOMATOR = "/system/bin/uiautomator"; //$NON-NLS-1$
	private static final String UIAUTOMATOR_DUMP_COMMAND = "dump"; //$NON-NLS-1$
	private static final String UIDUMP_DEVICE_PATH = "/data/local/tmp/uidump.xml"; //$NON-NLS-1$

	@SuppressWarnings("unused")
	private static boolean supportsUiAutomator(IDevice device) {
		String apiLevelString = device.getProperty(IDevice.PROP_BUILD_API_LEVEL);
		int apiLevel;
		try {
			apiLevel = Integer.parseInt(apiLevelString);
		} catch (NumberFormatException e) {
			apiLevel = UIAUTOMATOR_MIN_API_LEVEL;
		}

		return apiLevel >= UIAUTOMATOR_MIN_API_LEVEL;
	}

	@SuppressWarnings("unused")
	private static void getUiHierarchyFile(IDevice device, File dst, IProgressMonitor monitor) {
		if (monitor == null) {
			monitor = new NullProgressMonitor();
		}

		monitor.subTask("Deleting old UI XML snapshot ...");
		String command = "rm " + UIDUMP_DEVICE_PATH;

		try {
			CountDownLatch commandCompleteLatch = new CountDownLatch(1);
			device.executeShellCommand(command, new CollectingOutputReceiver(commandCompleteLatch));
			commandCompleteLatch.await(5, TimeUnit.SECONDS);
		} catch (Exception e1) {
			// ignore exceptions while deleting stale files
		}

		monitor.subTask("Taking UI XML snapshot...");
		command = String.format("%s %s %s", UIAUTOMATOR, UIAUTOMATOR_DUMP_COMMAND, UIDUMP_DEVICE_PATH);
		CountDownLatch commandCompleteLatch = new CountDownLatch(1);

		try {
			device.executeShellCommand(command, new CollectingOutputReceiver(commandCompleteLatch));
			commandCompleteLatch.await(20, TimeUnit.SECONDS);

			monitor.subTask("Pull UI XML snapshot from device...");
			device.getSyncService().pullFile(UIDUMP_DEVICE_PATH, dst.getAbsolutePath(),
					SyncService.getNullProgressMonitor());
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
	}

	public static UiAutomatorResult takeSnapshot(IProgressMonitor monitor, IDevice device) throws UiAutomatorException {
		if (monitor == null) {
			monitor = new NullProgressMonitor();
		}
		monitor.subTask("Obtaining UI hierarcy");
//		String uiHierarcy = driver.getPageSource();
		String uiHierarcy = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><hierarchy rotation=\"1\"><node bounds=\"[0,0][2560,1440]\" frame_size=\"{&quot;height&quot;:1440,&quot;width&quot;:2560}\" index=\"1\" name=\"widget_root\" type=\"DrawingEmpty\" xpath=\"/\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element\"><node bounds=\"[0,0][2560,1440]\" index=\"3\" name=\"\" type=\"\" xpath=\"//element/element\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"taskRewardLayout\" type=\"View\" xpath=\"//element/element/taskRewardLayout\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/bg\"/><node bounds=\"[250,66][2406,1374]\" index=\"1\" name=\"content\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content\"><node bounds=\"[50,260][276,700]\" index=\"1\" name=\"dayRewardTagBtn\" type=\"Button\" xpath=\"//element/element/taskRewardLayout/content/dayRewardTagBtn\"><node bounds=\"[146,250][546,450]\" index=\"1\" name=\"Text3\" text=\"每\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardTagBtn/Text3\"/><node bounds=\"[146,320][546,520]\" index=\"1\" name=\"Text31\" text=\"日\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardTagBtn/Text31\"/><node bounds=\"[146,390][546,590]\" index=\"1\" name=\"Text32\" text=\"签\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardTagBtn/Text32\"/><node bounds=\"[146,460][546,660]\" index=\"1\" name=\"Text33\" text=\"到\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardTagBtn/Text33\"/></node><node bounds=\"[50,740][276,1180]\" index=\"1\" name=\"dayTaskTagBtn\" type=\"Button\" xpath=\"//element/element/taskRewardLayout/content/dayTaskTagBtn\"><node bounds=\"[146,730][546,930]\" index=\"1\" name=\"Text4\" text=\"每\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayTaskTagBtn/Text4\"/><node bounds=\"[146,800][546,1000]\" index=\"1\" name=\"Text41\" text=\"日\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayTaskTagBtn/Text41\"/><node bounds=\"[146,870][546,1070]\" index=\"1\" name=\"Text42\" text=\"任\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayTaskTagBtn/Text42\"/><node bounds=\"[146,940][546,1140]\" index=\"1\" name=\"Text43\" text=\"务\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayTaskTagBtn/Text43\"/></node><node bounds=\"[250,66][2406,1374]\" index=\"1\" name=\"content\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/content\"/><node bounds=\"[300,262][1664,1334]\" index=\"1\" name=\"dayRewardView\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView\"><node bounds=\"[286,238][1678,1346]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/bg\"/><node bounds=\"[306,1138][1658,1334]\" index=\"1\" name=\"progressView\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView\"><node bounds=\"[306,1138][1658,1334]\" index=\"1\" name=\"progress\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/progress\"><node bounds=\"[307,1137][1657,1335]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/progress/bg\"/><node bounds=\"[304,1278][1660,1330]\" index=\"1\" name=\"fg\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/progress/fg\"/></node><node bounds=\"[306,1138][1658,1334]\" index=\"1\" name=\"rewardView\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView\"><node bounds=\"[306,1138][642,1334]\" index=\"1\" name=\"first\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/first\"><node bounds=\"[306,1138][642,1334]\" index=\"1\" name=\"bg\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/first/bg\"><node bounds=\"[467,1154][637,1214]\" index=\"1\" name=\"reward\" text=\"x1\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/first/bg/reward\"/><node bounds=\"[467,1212][637,1278]\" index=\"1\" name=\"day\" text=\"7天\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/first/bg/day\"/></node><node bounds=\"[304,1143][464,1281]\" index=\"1\" name=\"icon\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/first/icon\"/></node><node bounds=\"[618,1138][954,1334]\" index=\"1\" name=\"second\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/second\"><node bounds=\"[618,1138][954,1334]\" index=\"1\" name=\"bg\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/second/bg\"><node bounds=\"[801,1154][971,1214]\" index=\"1\" name=\"reward\" text=\"x1\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/second/bg/reward\"/><node bounds=\"[801,1212][971,1278]\" index=\"1\" name=\"day\" text=\"14天\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/second/bg/day\"/></node><node bounds=\"[634,1143][794,1281]\" index=\"1\" name=\"icon\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/second/icon\"/></node><node bounds=\"[940,1138][1276,1334]\" index=\"1\" name=\"third\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/third\"><node bounds=\"[940,1138][1276,1334]\" index=\"1\" name=\"bg\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/third/bg\"><node bounds=\"[1143,1154][1313,1214]\" index=\"1\" name=\"reward\" text=\"x1\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/third/bg/reward\"/><node bounds=\"[1143,1212][1313,1278]\" index=\"1\" name=\"day\" text=\"21天\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/third/bg/day\"/></node><node bounds=\"[978,1143][1138,1281]\" index=\"1\" name=\"icon\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/third/icon\"/></node><node bounds=\"[1278,1138][1614,1334]\" index=\"1\" name=\"fourth\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/fourth\"><node bounds=\"[1278,1138][1614,1334]\" index=\"1\" name=\"bg\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/fourth/bg\"><node bounds=\"[1481,1154][1651,1214]\" index=\"1\" name=\"reward\" text=\"x1\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/fourth/bg/reward\"/><node bounds=\"[1481,1212][1651,1278]\" index=\"1\" name=\"day\" text=\"满月\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/fourth/bg/day\"/></node><node bounds=\"[1314,1143][1474,1281]\" index=\"1\" name=\"icon\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/progressView/rewardView/fourth/icon\"/></node></node></node><node bounds=\"[300,266][1664,968]\" index=\"1\" name=\"signupView\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView\"><node bounds=\"[304,328][1660,968]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/bg\"/><node bounds=\"[300,256][1664,390]\" index=\"1\" name=\"topView\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/topView\"><node bounds=\"[302,256][1658,386]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/topView/bg\"/><node bounds=\"[754,274][852,372]\" index=\"1\" name=\"dayNumBg\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/topView/dayNumBg\"><node bounds=\"[236,281][656,361]\" index=\"1\" name=\"signupTips1\" text=\"你已连续签到\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/topView/dayNumBg/signupTips1\"/><node bounds=\"[663,285][723,357]\" index=\"1\" name=\"signupTips2\" text=\"0\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/topView/dayNumBg/signupTips2\"/><node bounds=\"[730,281][800,361]\" index=\"1\" name=\"signupTips3\" text=\"天\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/topView/dayNumBg/signupTips3\"/></node><node bounds=\"[1452,277][1634,361]\" index=\"1\" name=\"buSignupBtn\" type=\"Button\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/topView/buSignupBtn\"><node bounds=\"[1464,279][1622,359]\" index=\"1\" name=\"name\" text=\"补 签\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/topView/buSignupBtn/name\"/></node></node><node bounds=\"[300,868][1664,968]\" index=\"1\" name=\"bottomView\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/bottomView\"><node bounds=\"[457,888][1227,948]\" index=\"1\" name=\"tips\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/bottomView/tips\"><node bounds=\"[455,881][625,947]\" index=\"1\" name=\"vipTips1\" text=\"VIP用户\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/bottomView/tips/vipTips1\"/><node bounds=\"[627,885][1011,951]\" index=\"1\" name=\"vipTips2\" text=\"每日签到即可获得\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/bottomView/tips/vipTips2\"/><node bounds=\"[1011,885][1203,951]\" index=\"1\" name=\"vipTips3\" text=\"翻倍奖励\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/bottomView/tips/vipTips3\"/></node><node bounds=\"[1254,867][1476,957]\" index=\"1\" name=\"openVip\" type=\"Button\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/bottomView/openVip\"><node bounds=\"[1265,852][1465,972]\" index=\"1\" name=\"Text1\" text=\"开通VIP\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/bottomView/openVip/Text1\"/></node></node><node bounds=\"[408,410][1556,820]\" index=\"1\" name=\"signupBtn\" type=\"Button\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/signupBtn\"><node bounds=\"[728,563][1412,667]\" index=\"1\" name=\"name\" text=\"签到领取500银币\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/signupBtn/name\"/><node bounds=\"[548,519][728,707]\" index=\"1\" name=\"rewardIcon\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/signupBtn/rewardIcon\"/></node><node bounds=\"[338,1064][1266,1130]\" index=\"1\" name=\"tips\" text=\"连续签到可获得额外礼包(每月1号重置)\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/dayRewardView/signupView/tips\"/></node></node><node bounds=\"[709,-46][1943,334]\" index=\"1\" name=\"titleImg\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/titleImg\"><node bounds=\"[1186,82][1466,174]\" index=\"1\" name=\"titleText\" text=\"每日签到\" type=\"Text\" xpath=\"//element/element/taskRewardLayout/content/titleImg/titleText\"/></node><node bounds=\"[2316,36][2436,156]\" index=\"1\" name=\"closeBtn\" type=\"Button\" xpath=\"//element/element/taskRewardLayout/content/closeBtn\"/><node bounds=\"[1826,644][2226,944]\" index=\"1\" name=\"adView\" type=\"View\" xpath=\"//element/element/taskRewardLayout/content/adView\"><node bounds=\"[1686,234][2366,1354]\" index=\"1\" name=\"rewardAd2\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/adView/rewardAd2\"/><node bounds=\"[1712,260][2340,1328]\" index=\"1\" name=\"rewardAd\" type=\"Image\" xpath=\"//element/element/taskRewardLayout/content/adView/rewardAd\"/><node bounds=\"[1712,260][2968,2396]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/taskRewardLayout/content/adView/element\"><node bounds=\"[1712,260][2340,1328]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/taskRewardLayout/content/adView/element/element\"/></node></node></node></node></node><node bounds=\"[0,0][2560,1440]\" index=\"2\" name=\"\" type=\"\" xpath=\"//element/element\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"messageBox\" type=\"View\" xpath=\"//element/element/messageBox\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"shadeBg\" type=\"Image\" xpath=\"//element/element/messageBox/shadeBg\"/><node bounds=\"[540,225][2020,1215]\" index=\"1\" name=\"centerView\" type=\"View\" xpath=\"//element/element/messageBox/centerView\"><node bounds=\"[540,225][2020,1215]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/messageBox/centerView/bg\"/><node bounds=\"[663,115][1897,495]\" index=\"1\" name=\"titleBg\" type=\"Image\" xpath=\"//element/element/messageBox/centerView/titleBg\"><node bounds=\"[1144,245][1416,345]\" index=\"1\" name=\"title\" text=\"登录超时\" type=\"Text\" xpath=\"//element/element/messageBox/centerView/titleBg/title\"/></node><node bounds=\"[550,355][2010,995]\" index=\"1\" name=\"mainView\" type=\"View\" xpath=\"//element/element/messageBox/centerView/mainView\"><node bounds=\"[680,495][1880,855]\" index=\"1\" name=\"content\" type=\"TextView\" xpath=\"//element/element/messageBox/centerView/mainView/content\"><node bounds=\"[680,495][1880,855]\" index=\"1\" name=\"\" text=\"登录已超时，大侠请重新登录\" type=\"\" xpath=\"//element/element/messageBox/centerView/mainView/content/element\"/></node></node><node bounds=\"[545,985][2015,1215]\" index=\"1\" name=\"bottomView\" type=\"View\" xpath=\"//element/element/messageBox/centerView/bottomView\"><node bounds=\"[545,940][2015,1140]\" index=\"1\" name=\"singleBtnView\" type=\"View\" xpath=\"//element/element/messageBox/centerView/bottomView/singleBtnView\"><node bounds=\"[1080,955][1480,1125]\" index=\"1\" name=\"btn1\" type=\"Button\" xpath=\"//element/element/messageBox/centerView/bottomView/singleBtnView/btn1\"><node bounds=\"[1080,985][1480,1083]\" index=\"1\" name=\"btn1Text\" text=\"重新登录\" type=\"Text\" xpath=\"//element/element/messageBox/centerView/bottomView/singleBtnView/btn1/btn1Text\"/></node></node></node></node></node></node><node bounds=\"[0,0][2560,1440]\" index=\"4\" name=\"\" type=\"\" xpath=\"//element/element\"><node bounds=\"[60,360][244,544]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/element\"><node bounds=\"[178,370][234,426]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/element/element\"/></node></node><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"hall\" type=\"View\" xpath=\"//element/element/hall\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/hall/bg\"><node bounds=\"[0,1266][2560,1440]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/bg/element\"/></node><node bounds=\"[0,0][2560,180]\" index=\"1\" name=\"Image_top_bg\" type=\"Image\" xpath=\"//element/element/hall/Image_top_bg\"/><node bounds=\"[0,1266][2560,1440]\" index=\"1\" name=\"Image_bottom_bg\" type=\"Image\" xpath=\"//element/element/hall/Image_bottom_bg\"/><node bounds=\"[1033,12][1527,162]\" index=\"1\" name=\"Image_tittle\" type=\"Image\" xpath=\"//element/element/hall/Image_tittle\"/><node bounds=\"[2112,1272][2560,1440]\" index=\"1\" name=\"Button_match\" type=\"Button\" xpath=\"//element/element/hall/Button_match\"><node bounds=\"[2052,1220][2612,1460]\" index=\"1\" name=\"matchCartoon\" type=\"Swf\" xpath=\"//element/element/hall/Button_match/matchCartoon\"><node bounds=\"[2052,1220][2612,1460]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element\"><node bounds=\"[2069,1229][2559,1439]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2083,1242][2559,1440]\" index=\"2\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2094,1233][2190,1331]\" index=\"3\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2180,1292][2276,1390]\" index=\"4\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2282,1220][2378,1318]\" index=\"5\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2399,1300][2495,1398]\" index=\"6\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[1934,1238][2782,1266]\" index=\"7\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2134,1195][2982,1223]\" index=\"8\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2003,1356][2737,1442]\" index=\"9\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[1984,1330][2718,1416]\" index=\"10\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2179,1125][2913,1211]\" index=\"11\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2090,1245][2562,1441]\" index=\"12\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2124,1223][2220,1271]\" index=\"13\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2123,1231][2219,1279]\" index=\"14\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2133,1233][2229,1281]\" index=\"15\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2146,1238][2242,1286]\" index=\"16\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2134,1317][2186,1369]\" index=\"17\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2161,1290][2263,1410]\" index=\"18\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2151,1288][2999,1316]\" index=\"19\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2271,1300][2523,1398]\" index=\"20\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2052,1220][2052,1220]\" index=\"21\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"><node bounds=\"[2091,1245][2091,1245]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element/element\"><node bounds=\"[2091,1245][2561,1441]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element/element/element\"/></node><node bounds=\"[2052,1220][2052,1220]\" index=\"2\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element/element\"><node bounds=\"[2229,1232][3283,1418]\" index=\"1\" name=\"n_27\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element/element/n_27\"/></node></node><node bounds=\"[2052,1220][2052,1220]\" index=\"22\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"><node bounds=\"[2176,1305][2176,1305]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element/element\"><node bounds=\"[2176,1305][2510,1395]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element/element/element\"/></node><node bounds=\"[2052,1220][2052,1220]\" index=\"2\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element/element\"><node bounds=\"[1920,1304][2974,1490]\" index=\"1\" name=\"n_30\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element/element/n_30\"/></node></node><node bounds=\"[2253,1287][2305,1339]\" index=\"23\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2232,1363][2284,1415]\" index=\"24\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2495,1351][2547,1403]\" index=\"25\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2367,1349][2419,1401]\" index=\"26\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2228,1358][2280,1410]\" index=\"27\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2193,1313][2245,1365]\" index=\"28\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2172,1389][2224,1441]\" index=\"29\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2387,1330][2439,1382]\" index=\"30\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2248,1318][2300,1370]\" index=\"31\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2255,1372][2307,1424]\" index=\"32\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2195,1390][2247,1442]\" index=\"33\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2214,1333][2266,1385]\" index=\"34\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2193,1409][2245,1461]\" index=\"35\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2396,1379][2448,1431]\" index=\"36\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2240,1279][2292,1331]\" index=\"37\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2185,1262][2237,1314]\" index=\"38\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2164,1338][2216,1390]\" index=\"39\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2423,1253][2475,1305]\" index=\"40\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2295,1235][2347,1287]\" index=\"41\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2172,1376][2224,1428]\" index=\"42\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2266,1311][2318,1363]\" index=\"43\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2229,1325][2281,1377]\" index=\"44\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2168,1283][2220,1335]\" index=\"45\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2208,1401][2260,1453]\" index=\"46\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2147,1359][2199,1411]\" index=\"47\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2425,1380][2477,1432]\" index=\"48\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2381,1266][2433,1318]\" index=\"49\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2287,1376][2339,1428]\" index=\"50\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/><node bounds=\"[2247,1246][2299,1298]\" index=\"51\" name=\"\" type=\"\" xpath=\"//element/element/hall/Button_match/matchCartoon/element/element\"/></node></node></node><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"layerView\" type=\"View\" xpath=\"//element/element/hall/layerView\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"hallNotice_layout\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallNotice_layout\"><node bounds=\"[291,232][2189,310]\" index=\"1\" name=\"stripsMessageBG\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallNotice_layout/stripsMessageBG\"><node bounds=\"[291,232][2237,310]\" index=\"1\" name=\"sendStripsBtn\" type=\"Button\" xpath=\"//element/element/hall/layerView/element/hallNotice_layout/stripsMessageBG/sendStripsBtn\"/><node bounds=\"[429,232][2189,310]\" index=\"1\" name=\"rotatingView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallNotice_layout/stripsMessageBG/rotatingView\"/></node><node bounds=\"[180,220][294,326]\" index=\"1\" name=\"talkBtn\" type=\"Button\" xpath=\"//element/element/hall/layerView/element/hallNotice_layout/talkBtn\"/></node></node><node bounds=\"[0,0][2560,1440]\" index=\"2\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"hallGameListView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView\"><node bounds=\"[0,347][2560,1113]\" index=\"1\" name=\"gameListView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView\"><node bounds=\"[1230,1115][1330,1215]\" index=\"1\" name=\"dotView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/dotView\"><node bounds=\"[1190,1120][1370,1210]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/dotView/element\"><node bounds=\"[1190,1120][1274,1204]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/dotView/element/element\"><node bounds=\"[1221,1134][1243,1190]\" index=\"1\" name=\"num\" text=\"1\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/dotView/element/element/num\"/></node><node bounds=\"[1280,1120][1364,1204]\" index=\"2\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/dotView/element/element\"><node bounds=\"[1311,1134][1333,1190]\" index=\"1\" name=\"num\" text=\"2\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/dotView/element/element/num\"/></node></node></node><node bounds=\"[0,347][2560,1113]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element\"><node bounds=\"[0,360][2560,1100]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element\"><node bounds=\"[135,360][727,1100]\" index=\"1\" name=\"game2\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2\"><node bounds=\"[135,360][727,1100]\" index=\"1\" name=\"hall_game_list_item\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item\"><node bounds=\"[154,358][708,1102]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg\"><node bounds=\"[186,370][676,1050]\" index=\"1\" name=\"logo\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo\"><node bounds=\"[309,984][553,1044]\" index=\"1\" name=\"onlineNumView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView\"><node bounds=\"[309,991][413,1037]\" index=\"1\" name=\"word\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/word\"/><node bounds=\"[419,979][553,1049]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/element\"><node bounds=\"[419,979][939,1049]\" index=\"1\" name=\"moneyView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/element/moneyView\"><node bounds=\"[419,979][939,1049]\" index=\"1\" name=\"moneyLayer\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/element/moneyView/moneyLayer\"><node bounds=\"[419,994][447,1034]\" index=\"1\" name=\"img1\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/element/moneyView/moneyLayer/img1\"/><node bounds=\"[449,994][461,1034]\" index=\"1\" name=\"img2\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/element/moneyView/moneyLayer/img2\"/><node bounds=\"[463,994][491,1034]\" index=\"1\" name=\"img3\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/element/moneyView/moneyLayer/img3\"/><node bounds=\"[493,994][521,1034]\" index=\"1\" name=\"img4\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/element/moneyView/moneyLayer/img4\"/><node bounds=\"[523,994][551,1034]\" index=\"1\" name=\"img5\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/onlineNumView/element/moneyView/moneyLayer/img5\"/></node></node></node></node><node bounds=\"[186,984][676,1044]\" index=\"1\" name=\"gameStatusView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game2/hall_game_list_item/bg/logo/gameStatusView\"/></node></node></node></node><node bounds=\"[701,360][1293,1100]\" index=\"1\" name=\"game7\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game7\"><node bounds=\"[701,360][1293,1100]\" index=\"1\" name=\"hall_game_list_item\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game7/hall_game_list_item\"><node bounds=\"[720,358][1274,1102]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game7/hall_game_list_item/bg\"><node bounds=\"[752,370][1242,1050]\" index=\"1\" name=\"logo\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game7/hall_game_list_item/bg/logo\"><node bounds=\"[752,984][1242,1044]\" index=\"1\" name=\"gameStatusView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game7/hall_game_list_item/bg/logo/gameStatusView\"><node bounds=\"[902,991][1092,1037]\" index=\"1\" name=\"newGamesIcon\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game7/hall_game_list_item/bg/logo/gameStatusView/newGamesIcon\"/></node></node></node></node></node><node bounds=\"[1266,360][1858,1100]\" index=\"1\" name=\"game6\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game6\"><node bounds=\"[1266,360][1858,1100]\" index=\"1\" name=\"hall_game_list_item\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game6/hall_game_list_item\"><node bounds=\"[1285,358][1839,1102]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game6/hall_game_list_item/bg\"><node bounds=\"[1317,370][1807,1050]\" index=\"1\" name=\"logo\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game6/hall_game_list_item/bg/logo\"><node bounds=\"[1317,984][1807,1044]\" index=\"1\" name=\"gameStatusView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game6/hall_game_list_item/bg/logo/gameStatusView\"><node bounds=\"[1467,991][1657,1037]\" index=\"1\" name=\"newGamesIcon\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game6/hall_game_list_item/bg/logo/gameStatusView/newGamesIcon\"/></node></node></node></node></node><node bounds=\"[1832,360][2424,1100]\" index=\"1\" name=\"game0\" type=\"\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game0\"><node bounds=\"[1832,360][2424,1100]\" index=\"1\" name=\"hall_game_list_item\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game0/hall_game_list_item\"><node bounds=\"[1851,358][2405,1102]\" index=\"1\" name=\"bg\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game0/hall_game_list_item/bg\"><node bounds=\"[1883,370][2373,1050]\" index=\"1\" name=\"logo\" type=\"Image\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game0/hall_game_list_item/bg/logo\"><node bounds=\"[1883,984][2373,1044]\" index=\"1\" name=\"gameStatusView\" type=\"View\" xpath=\"//element/element/hall/layerView/element/hallGameListView/gameListView/element/element/game0/hall_game_list_item/bg/logo/gameStatusView\"/></node></node></node></node></node></node></node></node><node bounds=\"[2402,632][2530,808]\" index=\"1\" name=\"right_arrow\" type=\"\" xpath=\"//element/element/hall/layerView/element/right_arrow\"><node bounds=\"[2402,632][2530,808]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/right_arrow/element\"/><node bounds=\"[2402,632][2530,808]\" index=\"2\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/right_arrow/element\"/><node bounds=\"[2434,638][2498,702]\" index=\"3\" name=\"\" type=\"\" xpath=\"//element/element/hall/layerView/element/right_arrow/element\"/></node></node></node><node bounds=\"[1460,1160][1560,1260]\" index=\"1\" name=\"changeServerView\" type=\"View\" xpath=\"//element/element/hall/changeServerView\"><node bounds=\"[1460,1160][1600,1260]\" index=\"1\" name=\"test\" type=\"Button\" xpath=\"//element/element/hall/changeServerView/test\"><node bounds=\"[1482,1177][1578,1243]\" index=\"1\" name=\"Text2\" text=\"测试\" type=\"Text\" xpath=\"//element/element/hall/changeServerView/test/Text2\"/></node><node bounds=\"[1620,1160][1760,1260]\" index=\"1\" name=\"prepublish\" type=\"Button\" xpath=\"//element/element/hall/changeServerView/prepublish\"><node bounds=\"[1642,1177][1738,1243]\" index=\"1\" name=\"Text2\" text=\"预发\" type=\"Text\" xpath=\"//element/element/hall/changeServerView/prepublish/Text2\"/></node><node bounds=\"[1780,1160][1920,1260]\" index=\"1\" name=\"online\" type=\"Button\" xpath=\"//element/element/hall/changeServerView/online\"><node bounds=\"[1802,1177][1898,1243]\" index=\"1\" name=\"Text2\" text=\"正式\" type=\"Text\" xpath=\"//element/element/hall/changeServerView/online/Text2\"/></node><node bounds=\"[1940,1160][2080,1260]\" index=\"1\" name=\"hall\" type=\"Button\" xpath=\"//element/element/hall/changeServerView/hall\"><node bounds=\"[1962,1177][2058,1243]\" index=\"1\" name=\"Text2\" text=\"大厅\" type=\"Text\" xpath=\"//element/element/hall/changeServerView/hall/Text2\"/></node></node><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"bottomBtnsView\" type=\"View\" xpath=\"//element/element/hall/bottomBtnsView\"><node bounds=\"[0,1264][800,1440]\" index=\"1\" name=\"bottomLeftView\" type=\"View\" xpath=\"//element/element/hall/bottomBtnsView/bottomLeftView\"><node bounds=\"[220,1263][548,1441]\" index=\"1\" name=\"reLoginBtn\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/bottomLeftView/reLoginBtn\"><node bounds=\"[264,1311][504,1393]\" index=\"1\" name=\"Text1\" text=\"重新登录\" type=\"Text\" xpath=\"//element/element/hall/bottomBtnsView/bottomLeftView/reLoginBtn/Text1\"/></node><node bounds=\"[0,1272][168,1440]\" index=\"1\" name=\"View_head\" type=\"View\" xpath=\"//element/element/hall/bottomBtnsView/bottomLeftView/View_head\"><node bounds=\"[0,1272][168,1440]\" index=\"1\" name=\"Button_head\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/bottomLeftView/View_head/Button_head\"/></node></node><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"hall_bottom_btns\" type=\"View\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns\"><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"View_left\" type=\"View\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_left\"><node bounds=\"[20,914][156,1070]\" index=\"1\" name=\"friend\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_left/friend\"/><node bounds=\"[20,1094][156,1250]\" index=\"1\" name=\"message\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_left/message\"/></node><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"View_bottom\" type=\"View\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom\"><node bounds=\"[1910,1270][2060,1436]\" index=\"1\" name=\"friendRoom\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom\"><node bounds=\"[1910,1258][2096,1424]\" index=\"1\" name=\"friendBtnCartoon\" type=\"Swf\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon\"><node bounds=\"[1910,1258][2097,1425]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element\"><node bounds=\"[1930,1291][2048,1381]\" index=\"1\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1944,1373][2034,1425]\" index=\"2\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1937,1356][2785,1384]\" index=\"3\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1914,1308][2648,1394]\" index=\"4\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1939,1300][2787,1328]\" index=\"5\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1945,1265][2679,1351]\" index=\"6\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[2019,1369][2867,1397]\" index=\"7\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1995,1396][2729,1482]\" index=\"8\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1913,1296][1965,1348]\" index=\"9\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[2063,1308][2115,1360]\" index=\"10\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[2007,1345][2059,1397]\" index=\"11\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1983,1350][2035,1402]\" index=\"12\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1973,1382][2025,1434]\" index=\"13\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[2012,1381][2064,1433]\" index=\"14\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[2018,1265][2070,1317]\" index=\"15\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1974,1282][2026,1334]\" index=\"16\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1945,1356][1997,1408]\" index=\"17\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[2041,1298][2093,1350]\" index=\"18\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[2036,1359][2088,1411]\" index=\"19\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/><node bounds=\"[1954,1310][2006,1362]\" index=\"20\" name=\"\" type=\"\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/friendBtnCartoon/element/element\"/></node></node><node bounds=\"[1996,1270][2060,1334]\" index=\"1\" name=\"dot\" type=\"Image\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/friendRoom/dot\"/></node><node bounds=\"[830,1270][980,1436]\" index=\"1\" name=\"backpack\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/backpack\"/><node bounds=\"[1700,1270][1850,1436]\" index=\"1\" name=\"activity\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/activity\"/><node bounds=\"[1490,1270][1640,1436]\" index=\"1\" name=\"freeMoney\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/freeMoney\"><node bounds=\"[1570,1264][1634,1328]\" index=\"1\" name=\"dot\" type=\"Image\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/freeMoney/dot\"/></node><node bounds=\"[1280,1270][1430,1436]\" index=\"1\" name=\"mall\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/mall\"/><node bounds=\"[1040,1270][1190,1436]\" index=\"1\" name=\"safeBox\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_bottom/safeBox\"/></node><node bounds=\"[0,0][2560,1440]\" index=\"1\" name=\"View_Top\" type=\"View\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top\"><node bounds=\"[2360,0][2500,160]\" index=\"1\" name=\"static_button_more\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/static_button_more\"><node bounds=\"[2388,36][2472,124]\" index=\"1\" name=\"Image36\" type=\"Image\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/static_button_more/Image36\"/></node><node bounds=\"[2192,40][2360,128]\" index=\"1\" name=\"static_text_time\" text=\"16:48\" type=\"Text\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/static_text_time\"/><node bounds=\"[50,0][190,160]\" index=\"1\" name=\"service\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/service\"><node bounds=\"[78,36][162,124]\" index=\"1\" name=\"Image34\" type=\"Image\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/service/Image34\"/></node><node bounds=\"[390,0][530,160]\" index=\"1\" name=\"rank\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/rank\"><node bounds=\"[420,38][500,122]\" index=\"1\" name=\"Image33\" type=\"Image\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/rank/Image33\"/></node><node bounds=\"[220,0][360,160]\" index=\"1\" name=\"setting\" type=\"Button\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/setting\"><node bounds=\"[248,36][332,124]\" index=\"1\" name=\"Image33\" type=\"Image\" xpath=\"//element/element/hall/bottomBtnsView/element/hall_bottom_btns/View_Top/setting/Image33\"/></node></node></node></node></node><node bounds=\"[2424,1036][2528,1168]\" index=\"1\" name=\"agendaBtn\" type=\"Button\" xpath=\"//element/element/hall/agendaBtn\"/></node></node></node></node></hierarchy>";
		UiAutomatorModel model = new UiAutomatorModel(uiHierarcy);

		monitor.subTask("Obtaining device screenshot");
//		byte[] imageBytes = driver.getScreenshotAs(OutputType.BYTES);
		File f = new File("F:/atxtest/screenshot_1309068259710093843.png");
		
		byte[] imageBytes = new byte[(int)f.length()];
		
		BufferedImage bi = null;
		try {
			InputStream in = new FileInputStream(f);
			in.read(imageBytes);
			in.close();
			bi = ImageIO.read(new ByteArrayInputStream(imageBytes));
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		BufferedImage scaledImage = new BufferedImage(bi.getWidth(), bi.getHeight(), BufferedImage.TYPE_INT_ARGB);// 把现有的bufferedImage的颜色模式转换为DirectColorModel
		Graphics2D localGraphics2D = scaledImage.createGraphics();
		localGraphics2D.drawImage(bi, 0, 0, scaledImage.getWidth(), scaledImage.getHeight(), null);
		localGraphics2D.dispose();
		ImageData imageData = convertToSWT(scaledImage);
		Image screenshot = new Image(Display.getDefault(), imageData);
		return new UiAutomatorResult(uiHierarcy, model, screenshot);
	}

	public static ImageData convertToSWT(BufferedImage bufferedImage) {
		if (bufferedImage.getColorModel() instanceof DirectColorModel) {
			DirectColorModel colorModel = (DirectColorModel) bufferedImage.getColorModel();
			PaletteData palette = new PaletteData(colorModel.getRedMask(), colorModel.getGreenMask(),
					colorModel.getBlueMask());
			ImageData data = new ImageData(bufferedImage.getWidth(), bufferedImage.getHeight(),
					colorModel.getPixelSize(), palette);
			WritableRaster raster = bufferedImage.getRaster();
			int[] pixelArray = new int[4];
			for (int y = 0; y < data.height; y++) {
				for (int x = 0; x < data.width; x++) {
					raster.getPixel(x, y, pixelArray);
					int pixel = palette.getPixel(new RGB(pixelArray[0], pixelArray[1], pixelArray[2]));
					data.setPixel(x, y, pixel);
				}
			}
			return data;
		} else if (bufferedImage.getColorModel() instanceof IndexColorModel) {
			IndexColorModel colorModel = (IndexColorModel) bufferedImage.getColorModel();
			int size = colorModel.getMapSize();
			byte[] reds = new byte[size];
			byte[] greens = new byte[size];
			byte[] blues = new byte[size];
			colorModel.getReds(reds);
			colorModel.getGreens(greens);
			colorModel.getBlues(blues);
			RGB[] rgbs = new RGB[size];
			for (int i = 0; i < rgbs.length; i++) {
				rgbs[i] = new RGB(reds[i] & 0xFF, greens[i] & 0xFF, blues[i] & 0xFF);
			}
			PaletteData palette = new PaletteData(rgbs);
			ImageData data = new ImageData(bufferedImage.getWidth(), bufferedImage.getHeight(),
					colorModel.getPixelSize(), palette);
			data.transparentPixel = colorModel.getTransparentPixel();
			WritableRaster raster = bufferedImage.getRaster();
			int[] pixelArray = new int[1];
			for (int y = 0; y < data.height; y++) {
				for (int x = 0; x < data.width; x++) {
					raster.getPixel(x, y, pixelArray);
					data.setPixel(x, y, pixelArray[0]);
				}
			}
			return data;
		}
		return null;
	}

	@SuppressWarnings("serial")
	public static class UiAutomatorException extends Exception {
		public UiAutomatorException(String msg, Throwable t) {
			super(msg, t);
		}
	}

	public static class UiAutomatorResult {
		public final String uiHierarchy;
		public final UiAutomatorModel model;
		public final Image screenshot;

		public UiAutomatorResult(String pageSource, UiAutomatorModel m, Image s) {
			uiHierarchy = pageSource;
			model = m;
			screenshot = s;
		}
	}
}
